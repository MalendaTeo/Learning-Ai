<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Learning AI Platform</title>
Â  Â  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  /* åŸºæœ¬è‡ªå®šç¾©æ¨£å¼ */
Â  Â  Â  Â  body { background-color: #f4f7f6; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
Â  Â  Â  Â  .container { max-width: 960px; background: #fff; padding: 30px; margin-top: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
Â  Â  Â  Â  h1, h2, h3 { color: #2c3e50; }
Â  Â  Â  Â  /* éš±è—å€å¡Š */
Â  Â  Â  Â  #quiz-section, #result-section, #loading-overlay { display: none; }
Â  Â  Â  Â  /* Loading é®ç½© */
Â  Â  Â  Â  #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
Â  Â  Â  Â  /* è€ƒè©¦ä»‹é¢æ¨£å¼ */
Â  Â  Â  Â  .question-card { border-left: 4px solid #0d6efd; padding: 20px; background: #f8f9fa; margin-bottom: 25px; border-radius: 8px; }
Â  Â  Â  Â  .sub-question { margin-top: 15px; padding: 15px; background: #fff; border: 1px solid #dee2e6; border-radius: 6px; }
Â  Â  Â  Â  .options-list .form-check { margin-bottom: 10px; padding: 10px 10px 10px 35px; border: 1px solid #e9ecef; border-radius: 6px; transition: all 0.2s; }
Â  Â  Â  Â  .options-list .form-check:hover { background-color: #e9ecef; }
Â  Â  Â  Â  .btn-primary { padding: 10px 25px; font-weight: 600; }
Â  Â  Â  Â  /* è¨ºæ–·å ±å‘Šæ¨£å¼ */
Â  Â  Â  Â  .diagnostic-report h3 { margin-top: 25px; border-bottom: 2px solid #0d6efd; padding-bottom: 10px; font-size: 1.3rem; }
Â  Â  Â  Â  .diagnostic-report ul { padding-left: 20px; }
Â  Â  Â  Â  .diagnostic-report li { margin-bottom: 10px; }
Â  Â  </style>

Â  Â  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

Â  Â  <script>
Â  Â  MathJax = {
Â  Â  Â  tex: {
Â  Â  Â  Â  inlineMath: [['$', '$'], ['\\(', '\\)']], // é…ç½®è¡Œå…§å…¬å¼åˆ†éš”ç¬¦
Â  Â  Â  Â  displayMath: [['$$', '$$'], ['\\[', '\\]']], // é…ç½®å€å¡Šå…¬å¼åˆ†éš”ç¬¦
Â  Â  Â  Â  processEscapes: true
Â  Â  Â  },
Â  Â  Â  svg: {
Â  Â  Â  Â  fontCache: 'global'
Â  Â  Â  }
Â  Â  };
Â  Â  </script>
Â  Â  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
</head>
<body>

<div id="loading-overlay" style="display: none;">
Â  Â  <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
Â  Â  Â  Â  <span class="visually-hidden">Loading...</span>
Â  Â  </div>
Â  Â  <h4 class="mt-3" id="loading-text">AI æ­£åœ¨è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</h4>
Â  Â  <p class="text-muted">é€™å¯èƒ½éœ€è¦ 30-60 ç§’ï¼Œå–æ±ºæ–¼å…§å®¹é•·åº¦ã€‚</p>
</div>

<div class="container">
Â  Â  <header class="d-flex flex-wrap justify-content-between align-items-center pb-3 mb-4 border-bottom">
Â  Â  Â  Â  <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
Â  Â  Â  Â  Â  Â  <span class="fs-3 fw-bold">Learning AI (V1)</span>
Â  Â  Â  Â  </a>
Â  Â  Â  Â  <div class="dropdown">
Â  Â  Â  Â  Â  Â  Â <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
Â  Â  Â  Â  Â  Â  Â  Â Language (Demo)
Â  Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â  Â  Â  Â <ul class="dropdown-menu" aria-labelledby="langDropdown">
Â  Â  Â  Â  Â  Â  Â  Â <li><a class="dropdown-item" href="#">English</a></li>
Â  Â  Â  Â  Â  Â  Â  Â <li><a class="dropdown-item" href="#">ä¸­æ–‡(ç°¡)</a></li>
Â  Â  Â  Â  Â  Â  Â  Â <li><a class="dropdown-item" href="#">ä¸­æ–‡(ç¹)</a></li>
Â  Â  Â  Â  Â  Â  Â  Â <li><a class="dropdown-item" href="#">Bahasa Melayu</a></li>
Â  Â  Â  Â  Â  Â  Â </ul>
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <div id="upload-section">
Â  Â  Â  Â  <h2 class="mb-4">æ•™å¸«å¾Œå°ï¼šèª²æ–‡ä¸Šå‚³èˆ‡å‘½é¡Œ</h2>
Â  Â  Â  Â  <p class="text-muted">è«‹å¡«å¯«èª²æ–‡è³‡è¨Šä¸¦è²¼ä¸Šç´”æ–‡å­—å…§å®¹ï¼ŒAI å°‡è‡ªå‹•ç‚ºæ‚¨ç”Ÿæˆè©¦é¡Œã€‚</p>
Â  Â  Â  Â  <form id="uploadForm">
Â  Â  Â  Â  Â  Â  <div class="row g-3 mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="stage" class="form-label">å­¸ç¿’éšæ®µ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="stage" name="stage" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="é«˜ä¸­" selected>é«˜ä¸­ (Senior High)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="åˆä¸­">åˆä¸­ (Junior High)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="grade" class="form-label">å¹´ç´š</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="grade" name="grade" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="é«˜ä¸€">é«˜ä¸€ / åˆä¸€</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="é«˜äºŒ" selected>é«˜äºŒ / åˆäºŒ</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="é«˜ä¸‰">é«˜ä¸‰ / åˆä¸‰</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="subject" class="form-label">ç§‘ç›®</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="subject" name="subject" placeholder="ä¾‹å¦‚ï¼šåŒ–å­¸" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="volume" class="form-label">å†Šåˆ¥</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="volume" name="volume" placeholder="ä¾‹å¦‚ï¼šç¬¬äºŒå†Š">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="lessonNum" class="form-label">èª²åˆ¥</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="lessonNum" name="lessonNum" placeholder="ä¾‹å¦‚ï¼šCh 5">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="lessonName" class="form-label">èª²å</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="lessonName" name="lessonName" placeholder="ä¾‹å¦‚ï¼šæ°§åŒ–é‚„åŸåæ‡‰" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="contentBody" class="form-label">èª²æ–‡å…§å®¹ (ç´”æ–‡å­—)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="form-control" id="contentBody" name="contentBody" rows="10" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šèª²æ–‡çš„ç´”æ–‡å­—å…§å®¹ã€‚æš«ä¸æ”¯æŒåœ–ç‰‡æˆ– PDF ç›´æ¥ä¸Šå‚³ã€‚" required></textarea>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="d-grid gap-2 d-md-flex justify-content-md-end">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary btn-lg">æäº¤ä¸¦ç”Ÿæˆè©¦é¡Œ</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>
Â  Â  </div>


Â  Â  <div id="quiz-section">
Â  Â  Â  Â  <div class="d-flex justify-content-between align-items-center mb-4">
Â  Â  Â  Â  Â  Â  Â <h2 id="quiz-title">éš¨å ‚æ¸¬é©—</h2>
Â  Â  Â  Â  Â  Â  Â <span class="badge bg-secondary fs-5" id="progress-badge">é€²åº¦: 1 / 10</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="progress mb-4" style="height: 5px;">
Â  Â  Â  Â  Â  Â  <div class="progress-bar" id="progress-bar-visual" role="progressbar" style="width: 0%"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="question-container">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
Â  Â  Â  Â  Â  Â  <button id="next-btn" class="btn btn-primary btn-lg">ä¸‹ä¸€é¡Œ</button>
Â  Â  Â  Â  </div>
Â  Â  </div>


Â  Â  <div id="result-section">
Â  Â  Â  Â  Â <div class="text-center mb-5">
Â  Â  Â  Â  Â  Â  <h2>æ¸¬é©—çµæœèˆ‡ AI è¨ºæ–·å ±å‘Š</h2>
Â  Â  Â  Â  Â  Â  <p class="lead text-muted">ä»¥ä¸‹æ˜¯æ‚¨çš„ AI å­¸ç¿’è¨ºç™‚é†«å¸«ç‚ºæ‚¨æä¾›çš„åˆ†æã€‚</p>
Â  Â  Â  Â  Â  Â  <div class="display-4 fw-bold text-primary" id="score-display">-- / 100</div>
Â  Â  Â  Â  Â  Â  <span class="badge bg-warning text-dark">(è¨»: ç›®å‰åƒ…åŒ…å«é¸æ“‡é¡Œå¾—åˆ†)</span>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <div class="card-header bg-primary text-white fw-bold">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ©º AI é†«å¸«è¨ºæ–·å ±å‘Š (Dr. AI Diagnostic Report)
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="card-body diagnostic-report" id="diagnostic-content">
Â  Â  Â  Â  Â  Â  Â  Â  <p>æ­£åœ¨è¼‰å…¥è¨ºæ–·å ±å‘Š...</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="text-center mt-5">
Â  Â  Â  Â  Â  Â  Â <button class="btn btn-outline-primary" onclick="location.reload()">è¿”å›é¦–é  (é–‹å§‹æ–°æ¸¬é©—)</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

</div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


<script>
// ================= å…¨åŸŸè®Šæ•¸æ§åˆ¶è€ƒè©¦æµç¨‹ =================
let currentQuizData = [];
let currentQuestionIndex = 0;
let studentAnswers = [];
let currentLessonId = null;

$(document).ready(function() {
Â  Â  // ç¶å®šä¸Šå‚³è¡¨å–®æäº¤äº‹ä»¶
Â  Â  $('#uploadForm').on('submit', function(e) {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  showLoading('AI æ­£åœ¨é–±è®€èª²æ–‡ä¸¦åŠªåŠ›å‘½é¡Œä¸­ (ç´„éœ€ 30-60 ç§’)...');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ç²å–è¡¨å–®è³‡æ–™
Â  Â  Â  Â  const formData = {
Â  Â  Â  Â  Â  Â  stage: $('#stage').val(),
Â  Â  Â  Â  Â  Â  grade: $('#grade').val(),
Â  Â  Â  Â  Â  Â  subject: $('#subject').val(),
Â  Â  Â  Â  Â  Â  volume: $('#volume').val(),
Â  Â  Â  Â  Â  Â  lessonNum: $('#lessonNum').val(),
Â  Â  Â  Â  Â  Â  lessonName: $('#lessonName').val(),
Â  Â  Â  Â  Â  Â  contentBody: $('#contentBody').val()
Â  Â  Â  Â  };

Â  Â  Â  Â  // å‘¼å«å¾Œç«¯ GAS å‡½æ•¸
Â  Â  Â  Â  google.script.run
Â  Â  Â  Â  Â  Â  .withSuccessHandler(function(response) {
Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  if (response.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(response.message);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // é–‹å§‹è€ƒè©¦æµç¨‹
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentLessonId = response.lessonId;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startQuiz(response.quizData);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('éŒ¯èª¤: ' + response.message);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .withFailureHandler(function(error) {
Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  alert('ä¼ºæœå™¨éŒ¯èª¤: ' + error.message);
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .handleUpload(formData);
Â  Â  });

Â  Â  // ç¶å®šä¸‹ä¸€é¡ŒæŒ‰éˆ•äº‹ä»¶
Â  Â  $('#next-btn').on('click', nextQuestion);
});

// é¡¯ç¤º Loading é®ç½©
function showLoading(text) {
Â  Â  $('#loading-text').text(text || 'Loading...');
Â  Â  $('#loading-overlay').fadeIn();
}
// éš±è— Loading é®ç½©
function hideLoading() {
Â  Â  $('#loading-overlay').fadeOut();
}

// ================= è€ƒè©¦æµç¨‹å‡½æ•¸ =================

// é–‹å§‹è€ƒè©¦ï¼šåˆå§‹åŒ–ç‹€æ…‹ä¸¦åˆ‡æ›ä»‹é¢
function startQuiz(questions) {
Â  Â  currentQuizData = questions;
Â  Â  currentQuestionIndex = 0;
Â  Â  studentAnswers = [];
Â  Â Â 
Â  Â  // åˆ‡æ›ä»‹é¢
Â  Â  $('#upload-section').hide();
Â  Â  $('#result-section').hide();
Â  Â  $('#quiz-section').fadeIn();

Â  Â  renderQuestion();
}

// æ¸²æŸ“ç•¶å‰é¡Œç›®
function renderQuestion() {
Â  Â  const question = currentQuizData[currentQuestionIndex];
Â  Â  const $container = $('#question-container');
Â  Â  $container.empty(); // æ¸…ç©ºèˆŠé¡Œ

Â  Â  // æ›´æ–°é€²åº¦æ¢
Â  Â  const progressText = `é€²åº¦: ${currentQuestionIndex + 1} / ${currentQuizData.length}`;
Â  Â  $('#progress-badge').text(progressText);
Â  Â  const progressPercent = ((currentQuestionIndex + 1) / currentQuizData.length) * 100;
Â  Â  $('#progress-bar-visual').css('width', progressPercent + '%');

Â  Â  // æ›´æ–°æŒ‰éˆ•æ–‡å­—
Â  Â  if (currentQuestionIndex === currentQuizData.length - 1) {
Â  Â  Â  Â  $('#next-btn').text('æŸ¥çœ‹çµæœ (æäº¤)');
Â  Â  } else {
Â  Â  Â  Â  $('#next-btn').text('ä¸‹ä¸€é¡Œ');
Â  Â  }

Â  Â  let html = '';
Â  Â Â 
Â  Â  // æ ¹æ“šé¡Œå‹ç”Ÿæˆä¸åŒçš„ HTML çµæ§‹
Â  Â  if (question.type === 'MCQ') {
Â  Â  Â  Â  html = `
Â  Â  Â  Â  Â  Â  <div class="question-card">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="badge bg-info text-dark mb-2">${question.context_tag || 'General'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="badge bg-secondary mb-2">${question.difficulty} | ${question.marks} åˆ†</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title fw-bold">${question.question_text}</h5>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="options-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${Object.entries(question.options).map(([key, value]) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-check">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input class="form-check-input" type="radio" name="mcq-option" id="option${key}" value="${key}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-check-label w-100" for="option${key}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>${key}.</strong> ${value}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  } else if (question.type === 'EIQ_GROUP' || question.type === 'SAQ_GROUP') {
Â  Â  Â  Â  // é¡Œçµ„å‹ (å¯¦é©—é¡Œæˆ–ç°¡ç­”é¡Œ)
Â  Â  Â  Â  html = `
Â  Â  Â  Â  Â  Â  <div class="question-card">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="badge bg-warning text-dark mb-2">é¡Œçµ„ | ${question.marks} åˆ†ç¸½åˆ†</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title fw-bold">${question.main_text}</h5>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  ${question.sub_questions.map(subQ => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="sub-question" data-sub-id="${subQ.sub_id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label fw-bold">${subQ.question_text} (${subQ.marks} åˆ†)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="form-control" rows="3" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  }

Â  Â  $container.html(html);

Â  Â  // ã€é‡è¦ã€‘é€šçŸ¥ MathJax é‡æ–°æ¸²æŸ“æ–°æ’å…¥çš„å…§å®¹ä¸­çš„å…¬å¼
Â  Â  if (window.MathJax) {
Â  Â  Â  Â  MathJax.typesetPromise && MathJax.typesetPromise([$container[0]]);
Â  Â  }
}

// è™•ç†ä¸‹ä¸€é¡Œé‚è¼¯
function nextQuestion() {
Â  Â  const question = currentQuizData[currentQuestionIndex];
Â  Â Â 
Â  Â  // 1. æ”¶é›†ç•¶å‰ç­”æ¡ˆ
Â  Â  if (question.type === 'MCQ') {
Â  Â  Â  Â  const selectedOption = $('input[name="mcq-option"]:checked').val();
Â  Â  Â  Â  if (!selectedOption) {
Â  Â  Â  Â  Â  Â  alert('è«‹é¸æ“‡ä¸€å€‹é¸é …ï¼');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  studentAnswers.push({
Â  Â  Â  Â  Â  Â  question_id: question.id,
Â  Â  Â  Â  Â  Â  student_response: selectedOption
Â  Â  Â  Â  });
Â  Â  } else {
Â  Â  Â  Â  // æ”¶é›†é¡Œçµ„çš„æ‰€æœ‰å°é¡Œç­”æ¡ˆ
Â  Â  Â  Â  const subAnswers = [];
Â  Â  Â  Â  $('#question-container .sub-question').each(function() {
Â  Â  Â  Â  Â  Â  const subId = $(this).data('sub-id');
Â  Â  Â  Â  Â  Â  const textVal = $(this).find('textarea').val();
Â  Â  Â  Â  Â  Â  if (textVal.trim() === "") {
Â  Â  Â  Â  Â  Â  Â  Â  Â // é€™è£¡å¯ä»¥é¸æ“‡æ˜¯å¦å¼·åˆ¶å­¸ç”Ÿä½œç­”ï¼ŒV1 æš«æ™‚å…è¨±ç•™ç©º
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  subAnswers.push({ sub_id: subId, response: textVal });
Â  Â  Â  Â  });
Â  Â  Â  Â  // å°‡è¤‡é›œçš„é¡Œçµ„ç­”æ¡ˆè½‰æ›ç‚ºå­—ä¸²å„²å­˜ï¼Œä»¥ä¾¿å¾Œç«¯è™•ç† (ç°¡åŒ– V1)
Â  Â  Â  Â  studentAnswers.push({
Â  Â  Â  Â  Â  Â  question_id: question.id,
Â  Â  Â  Â  Â  Â  student_response: JSON.stringify(subAnswers)Â 
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // 2. åˆ¤æ–·æ˜¯å¦çµæŸ
Â  Â  if (currentQuestionIndex < currentQuizData.length - 1) {
Â  Â  Â  Â  currentQuestionIndex++;
Â  Â  Â  Â  renderQuestion();
Â  Â  } else {
Â  Â  Â  Â  // æäº¤è©¦å·
Â  Â  Â  Â  submitQuiz();
Â  Â  }
}

// æäº¤è©¦å·ä¸¦ç²å–çµæœ
function submitQuiz() {
Â  Â  showLoading('æ­£åœ¨æ‰¹æ”¹è©¦å·ä¸¦é€²è¡Œ AI è¨ºæ–· (ç´„éœ€ 60 ç§’)...');

Â  Â  const submissionData = {
Â  Â  Â  Â  lessonId: currentLessonId,
Â  Â  Â  Â  studentName: 'æ¸¬è©¦å­¸ç”Ÿ (V1)', // V1 æš«æ™‚å¯«æ­»
Â  Â  Â  Â  answers: studentAnswers
Â  Â  };

Â  Â  google.script.run
Â  Â  Â  Â  .withSuccessHandler(function(response) {
Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  if (response.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  showResults(response);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  alert('æ‰¹æ”¹å¤±æ•—: ' + response.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .withFailureHandler(function(error) {
Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  alert('æäº¤æ™‚ç™¼ç”ŸéŒ¯èª¤: ' + error.message);
Â  Â  Â  Â  })
Â  Â  Â  Â  .handleGrading(submissionData);
}

// é¡¯ç¤ºçµæœé é¢
function showResults(data) {
Â  Â  $('#quiz-section').hide();
Â  Â  $('#result-section').fadeIn();

Â  Â  $('#score-display').text(`${data.mcqScore} / 100`);
Â  Â  // æ’å…¥ AI ç”Ÿæˆçš„ HTML è¨ºæ–·å ±å‘Š
Â  Â  $('#diagnostic-content').html(data.diagnostic);
}

</script>
</body>
</html>
